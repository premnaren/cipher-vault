<!DOCTYPE html>
<html lang="en" data-theme="void">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cipher Vault | Secure Terminal</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsencrypt/3.3.2/jsencrypt.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;900&family=Rajdhani:wght@500;700&family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Inter:wght@400;600;900&display=swap');

        :root[data-theme="void"] { --bg-body: #050508; --bg-panel: #0f1015; --primary: #00f3ff; --accent: #bc13fe; --border: #1e293b; --glow: 0 0 20px rgba(0, 243, 255, 0.2); }
        
        /* --- CURSOR SYSTEM --- */
        body { 
            background-color: var(--bg-body); 
            color: #e2e8f0; 
            font-family: 'Inter', sans-serif; 
            background-image: radial-gradient(var(--border) 1px, transparent 1px); 
            background-size: 30px 30px;
            cursor: none !important; /* Hide default cursor */
        }

        /* Force hide cursor on all interactables */
        a, button, input, textarea, select, label, .tool-btn {
            cursor: none !important;
        }

        /* --- THE SNIPER CROSSHAIR CURSOR --- */
        #app-cursor {
            position: fixed;
            top: 0; left: 0;
            z-index: 9999;
            pointer-events: none;
            transform: translate(-50%, -50%);
            mix-blend-mode: difference;
            width: 30px; height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Center Dot */
        .cursor-dot {
            width: 4px; height: 4px;
            background-color: #00f3ff;
            border-radius: 50%;
            position: absolute;
            z-index: 2;
            box-shadow: 0 0 5px #00f3ff;
            transition: all 0.2s ease;
        }

        /* Crosshair Lines */
        .cursor-line {
            position: absolute;
            background-color: #00f3ff;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Vertical Lines */
        .line-v { width: 2px; height: 10px; }
        .line-v.top { top: 0; }
        .line-v.bottom { bottom: 0; }

        /* Horizontal Lines */
        .line-h { width: 10px; height: 2px; }
        .line-h.left { left: 0; }
        .line-h.right { right: 0; }

        /* --- HOVER STATE: TARGET LOCKED --- */
        body.hovering .cursor-dot {
            background-color: #bc13fe; /* Purple */
            box-shadow: 0 0 10px #bc13fe;
            transform: scale(1.5);
        }

        body.hovering #app-cursor {
            transform: translate(-50%, -50%) rotate(45deg); /* Spin 45 degrees */
        }

        body.hovering .cursor-line {
            background-color: #bc13fe;
        }

        /* Clamp lines inward */
        body.hovering .line-v { height: 14px; } 
        body.hovering .line-h { width: 14px; }
        
        /* Eliminate gap on hover */
        body.hovering .line-v.top { top: 8px; } 
        body.hovering .line-v.bottom { bottom: 8px; }
        body.hovering .line-h.left { left: 8px; } 
        body.hovering .line-h.right { right: 8px; }


        /* --- UI STYLES --- */
        .orbitron { font-family: 'Orbitron', sans-serif; } 
        .mono { font-family: 'Space Mono', monospace; }
        .card-inner { transform-style: preserve-3d; }
        .perspective-container { perspective: 1200px; }

        ::-webkit-scrollbar { width: 8px; } 
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; } 
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        .modal-bg { background: rgba(0, 0, 0, 0.9); -webkit-backdrop-filter: blur(5px); backdrop-filter: blur(5px); }
    </style>
</head>
<body class="h-screen w-screen flex flex-col overflow-hidden">

    <div id="app-cursor">
        <div class="cursor-dot"></div>
        <div class="cursor-line line-v top"></div>
        <div class="cursor-line line-v bottom"></div>
        <div class="cursor-line line-h left"></div>
        <div class="cursor-line line-h right"></div>
    </div>

    <nav class="fixed top-0 w-full p-4 flex justify-between items-center z-50 bg-[var(--bg-panel)]/90 backdrop-blur border-b border-[var(--border)]">
        <div class="flex items-center gap-4">
            <button id="termBtn" onclick="showPage('terminal')" class="flex items-center gap-2 text-[var(--primary)] font-bold border border-[var(--primary)] bg-black/40 px-5 py-2 rounded-full shadow-[0_0_15px_rgba(0,243,255,0.2)] transition-all">
                <span class="tracking-[0.15em] text-xs font-mono">TERMINAL</span>
            </button>
            <button id="libBtn" onclick="showPage('library')" class="flex items-center gap-3 text-gray-500 font-bold border border-transparent bg-transparent px-5 py-2 rounded-full hover:text-white transition-all">
                <span class="tracking-[0.15em] text-xs font-mono">VIDEO LIBRARY</span>
            </button>
            <button onclick="toggleVault(true)" class="flex items-center gap-2 text-[var(--accent)] font-bold border border-[var(--border)] bg-black/20 px-5 py-2 rounded-full hover:border-[var(--primary)] hover:text-[var(--primary)] group">
                <span class="text-lg group-hover:animate-pulse">ðŸ”’</span> <span class="tracking-[0.15em] text-xs font-mono">VAULT</span>
            </button>
            <a href="/chat" class="flex items-center gap-2 text-[var(--primary)] font-bold border border-[var(--border)] bg-black/20 px-5 py-2 rounded-full hover:border-[var(--primary)] hover:bg-[var(--primary)] hover:text-black transition-all">
                <span class="text-lg">ðŸ’¬</span> <span class="tracking-[0.15em] text-xs font-mono">CHAT</span>
            </a>
        </div>
        <div class="flex items-center gap-4">
            <h1 class="text-2xl font-black tracking-widest hidden xl:block orbitron">CIPHER <span class="text-[var(--primary)]">VAULT</span></h1>
            <button onclick="logout()" class="px-4 py-2 border border-red-900/50 text-red-500 rounded text-xs font-bold hover:bg-red-900/20">LOGOUT</button>
        </div>
    </nav>

    <main id="terminalPage" class="flex-grow flex items-center justify-center p-4 pt-24 perspective-container h-full">
        <div id="mainCard" class="card-inner w-full max-w-5xl bg-[var(--bg-panel)] border border-[var(--border)] shadow-[var(--glow)] rounded-xl relative overflow-hidden flex flex-col max-h-full">
            
            <div class="p-6 border-b border-[var(--border)] flex justify-between items-center bg-black/20 shrink-0">
                <div>
                    <h2 id="modeTitle" class="text-3xl font-bold tracking-widest orbitron text-[var(--primary)]">ENCRYPTION MODE</h2>
                    <p class="text-[10px] mono text-gray-500">SYSTEM STATUS: READY // AUTO-KEY MEMORY: <span id="memoryStatus" class="text-red-500 font-bold">OFFLINE</span></p>
                </div>
                <button id="swapModeBtn" class="flex items-center gap-3 px-6 py-3 bg-[var(--border)] hover:bg-[var(--primary)] hover:text-black transition-all rounded group">
                    <div class="text-right"><div class="text-[10px] font-bold uppercase opacity-50">Current Mode</div><div class="text-sm font-bold" id="swapBtnText">ENCRYPT</div></div>
                    <svg class="w-6 h-6 group-hover:rotate-180 transition-transform duration-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" /></svg>
                </button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-0 flex-grow overflow-hidden">
                
                <div class="p-6 space-y-6 border-r border-[var(--border)] relative overflow-y-auto">
                    <div>
                        <label for="algoSelect" class="text-[10px] font-bold text-gray-500 uppercase mb-2 block font-mono">Algorithm Selection</label>
                        <select id="algoSelect" title="Select Algorithm" aria-label="Select Algorithm" class="w-full bg-[var(--bg-body)] border border-[var(--border)] p-3 rounded text-sm font-bold focus:border-[var(--primary)] outline-none transition-colors text-white font-mono">
                            <optgroup label="Classical Ciphers">
                                <option value="atbash">1. Atbash Cipher</option>
                                <option value="caesar">2. Caesar Cipher</option>
                                <option value="playfair">3. Playfair Cipher</option>
                                <option value="vigenere">4. VigenÃ¨re Cipher</option>
                                <option value="rail_fence">5. Rail Fence Cipher</option>
                                <option value="pigpen">6. Pigpen Cipher</option>
                            </optgroup>
                            <optgroup label="Modern Encryption">
                                <option value="aes" selected>7. AES-256 (Standard)</option>
                                <option value="rsa">8. RSA (Asymmetric)</option>
                                <option value="ecc">9. ECC (Elliptic Curve)</option>
                            </optgroup>
                            <optgroup label="Covert Operations">
                                <option value="steganography">10. Steganography (Image)</option>
                            </optgroup>
                        </select>
                    </div>

                    <div id="dynamicInputs" class="space-y-4">
                        <div id="stdInputGroup">
                            <label class="text-[10px] font-bold text-gray-500 uppercase mb-2 block font-mono">Input Data</label>
                            <textarea id="mainInput" title="Enter Text to Encrypt" aria-label="Enter Text to Encrypt" class="w-full h-32 bg-[var(--bg-body)] border border-[var(--border)] p-3 rounded mono text-sm focus:border-[var(--primary)] outline-none resize-none" placeholder="Enter text..."></textarea>
                        </div>

                        <div id="stegoInputGroup" class="hidden">
                            <label class="text-[10px] font-bold text-[var(--accent)] uppercase mb-2 block font-mono">Image Source</label>
                            <input type="file" id="stegoFile" title="Upload Source Image" aria-label="Upload Source Image" accept="image/png" class="w-full text-xs text-gray-500 file:bg-[var(--accent)] file:text-black file:border-0 file:px-2 file:py-1 file:rounded file:font-bold mb-2">
                            <div id="stegoTextContainer">
                                <label class="text-[10px] font-bold text-gray-500 uppercase mb-2 block font-mono">Secret Payload</label>
                                <textarea id="stegoPayload" title="Enter Secret Message" aria-label="Enter Secret Message" class="w-full h-20 bg-[var(--bg-body)] border border-[var(--border)] p-3 rounded mono text-sm focus:border-[var(--accent)] outline-none" placeholder="Message to hide..."></textarea>
                            </div>
                        </div>

                        <div id="keyGroup">
                            <label class="text-[10px] font-bold text-gray-500 uppercase mb-2 block font-mono">Encryption Key</label>
                            <input id="keyInput" type="text" title="Enter Encryption Key" aria-label="Enter Encryption Key" class="w-full bg-[var(--bg-body)] border border-[var(--border)] p-3 rounded mono text-[var(--primary)] focus:border-[var(--primary)] outline-none" placeholder="Key / Shift / Password">
                            
                            <textarea id="rsaKeyInput" title="RSA Key Input" aria-label="RSA Key Input" class="hidden w-full h-24 bg-[var(--bg-body)] border border-[var(--border)] p-2 rounded mono text-[10px] text-[var(--primary)] focus:border-[var(--primary)] outline-none" placeholder="Paste Key Here... (Leave empty to Auto-Generate on Encrypt)"></textarea>
                        </div>

                        <button id="processBtn" class="w-full py-4 bg-[var(--primary)] text-black font-black tracking-widest rounded hover:shadow-[0_0_20px_rgba(0,243,255,0.4)] transition-all orbitron">
                            EXECUTE PROCESS
                        </button>
                    </div>
                </div>

                <div class="p-6 bg-black/20 flex flex-col h-full relative overflow-y-auto">
                    <div class="flex justify-between items-center mb-4"> 
                        <label class="text-[10px] font-bold text-gray-500 uppercase block font-mono">System Output</label> 
                        <button id="copyBtn" class="flex items-center gap-2 px-3 py-1 border border-[var(--primary)] text-[var(--primary)] hover:bg-[var(--primary)] hover:text-black transition-all rounded text-[10px] font-bold font-mono group">
                            <span>COPY RESULT</span>
                        </button>
                    </div>
                    <div class="flex-grow bg-[var(--bg-body)] border border-[var(--border)] rounded p-4 mono text-sm text-[var(--accent)] break-all whitespace-pre-wrap overflow-y-auto relative">
                        <div id="outputDisplay">// WAITING FOR INPUT...</div>
                        <canvas id="stegoCanvas" class="hidden"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <main id="libraryPage" class="hidden flex-grow pt-24 px-4 pb-12 overflow-y-auto h-full">
        <div class="w-full max-w-7xl mx-auto">
            <div class="text-center mb-10">
                <h2 class="text-4xl orbitron text-[var(--primary)] mb-2 tracking-widest">CIPHER <span class="text-white">ARSENAL</span></h2>
                <p class="text-gray-500 font-mono text-xs tracking-[0.3em]">VIDEO TUTORIAL DATABASE</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-20">
                <div class="border border-[var(--border)] bg-black/40 p-4 rounded-xl hover:border-[var(--primary)]"><h3 class="text-lg orbitron text-white mb-2">1. ATBASH</h3><div class="aspect-video w-full border border-gray-700 bg-black"><iframe title="Atbash Tutorial" class="w-full h-full" src="https://www.youtube.com/embed/zt5Ax2TmZJI" frameborder="0" allowfullscreen></iframe></div></div>
                <div class="border border-[var(--border)] bg-black/40 p-4 rounded-xl hover:border-[var(--primary)]"><h3 class="text-lg orbitron text-white mb-2">2. CAESAR</h3><div class="aspect-video w-full border border-gray-700 bg-black"><iframe title="Caesar Tutorial" class="w-full h-full" src="https://www.youtube.com/embed/JtbKh_12ctg" frameborder="0" allowfullscreen></iframe></div></div>
                <div class="border border-[var(--border)] bg-black/40 p-4 rounded-xl hover:border-[var(--primary)]"><h3 class="text-lg orbitron text-white mb-2">3. PLAYFAIR</h3><div class="aspect-video w-full border border-gray-700 bg-black"><iframe title="Playfair Tutorial" class="w-full h-full" src="https://www.youtube.com/embed/1q37X_y9-lc" frameborder="0" allowfullscreen></iframe></div></div>
                <div class="border border-[var(--border)] bg-black/40 p-4 rounded-xl hover:border-[var(--primary)]"><h3 class="text-lg orbitron text-white mb-2">4. VIGENERE</h3><div class="aspect-video w-full border border-gray-700 bg-black"><iframe title="Vigenere Tutorial" class="w-full h-full" src="https://www.youtube.com/embed/SkJcmCaHqS0" frameborder="0" allowfullscreen></iframe></div></div>
                <div class="border border-[var(--border)] bg-black/40 p-4 rounded-xl hover:border-[var(--primary)]"><h3 class="text-lg orbitron text-white mb-2">5. RAIL FENCE</h3><div class="aspect-video w-full border border-gray-700 bg-black"><iframe title="Rail Fence Tutorial" class="w-full h-full" src="https://www.youtube.com/embed/wKjRwJTXQH4" frameborder="0" allowfullscreen></iframe></div></div>
                <div class="border border-[var(--border)] bg-black/40 p-4 rounded-xl hover:border-[var(--primary)]"><h3 class="text-lg orbitron text-white mb-2">6. PIGPEN</h3><div class="aspect-video w-full border border-gray-700 bg-black"><iframe title="Pigpen Tutorial" class="w-full h-full" src="https://www.youtube.com/embed/vZrTJOhALmA" frameborder="0" allowfullscreen></iframe></div></div>
                <div class="border border-[var(--border)] bg-black/40 p-4 rounded-xl hover:border-[var(--primary)]"><h3 class="text-lg orbitron text-white mb-2">7. AES-256</h3><div class="aspect-video w-full border border-gray-700 bg-black"><iframe title="AES Tutorial" class="w-full h-full" src="https://www.youtube.com/embed/O4xNJsjtN6E" frameborder="0" allowfullscreen></iframe></div></div>
                <div class="border border-[var(--border)] bg-black/40 p-4 rounded-xl hover:border-[var(--primary)]"><h3 class="text-lg orbitron text-white mb-2">8. RSA</h3><div class="aspect-video w-full border border-gray-700 bg-black"><iframe title="RSA Tutorial" class="w-full h-full" src="https://www.youtube.com/embed/4zahvcJ9glg" frameborder="0" allowfullscreen></iframe></div></div>
                <div class="border border-[var(--border)] bg-black/40 p-4 rounded-xl hover:border-[var(--primary)]"><h3 class="text-lg orbitron text-white mb-2">9. ECC</h3><div class="aspect-video w-full border border-gray-700 bg-black"><iframe title="ECC Tutorial" class="w-full h-full" src="https://www.youtube.com/embed/NF1pwjL9-DE" frameborder="0" allowfullscreen></iframe></div></div>
                <div class="border border-[var(--accent)] bg-black/40 p-4 rounded-xl hover:border-white transition-all"><h3 class="text-lg orbitron text-[var(--accent)] mb-2">10. STEGANOGRAPHY</h3><div class="aspect-video w-full border border-gray-700 bg-black"><iframe title="Steganography Tutorial" class="w-full h-full" src="https://www.youtube.com/embed/TWEXCYQKyDc" frameborder="0" allowfullscreen></iframe></div></div>
            </div>
        </div>
    </main>

    <div id="vaultModal" class="fixed inset-0 z-[80] flex items-center justify-center hidden opacity-0 transition-opacity duration-300 pointer-events-none modal-bg">
        <div class="relative bg-[var(--bg-panel)] border border-[var(--primary)] w-full max-w-4xl rounded-xl shadow-[0_0_50px_rgba(0,243,255,0.15)] flex flex-col h-[600px] md:h-auto p-6">
            <div class="flex justify-between items-center mb-6 border-b border-[var(--border)] pb-4">
                <h3 class="text-2xl font-black tracking-widest text-[var(--accent)] orbitron">ZERO-KNOWLEDGE <span class="text-[var(--primary)]">VAULT</span></h3>
                <button onclick="toggleVault(false)" class="text-gray-500 hover:text-white font-mono text-xl">âœ•</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="col-span-1 bg-white/5 border border-white/10 rounded p-6">
                    <label class="text-xs font-mono text-[var(--primary)] mb-2 block tracking-widest">1. SELECT ASSET</label>
                    <input type="file" id="vaultInput" title="File Upload" aria-label="File Upload" class="w-full text-xs text-gray-500 mb-4 file:bg-[var(--primary)] file:border-0 file:text-black file:font-bold file:px-2 file:py-1 file:rounded">
                    <label class="text-xs font-mono text-[var(--accent)] mb-2 block tracking-widest">2. PASSWORD</label>
                    <input type="password" id="vaultPass" title="Vault Password" aria-label="Vault Password" placeholder="Required" class="w-full bg-black border border-[var(--border)] text-xs text-[var(--accent)] p-2 rounded mb-4 focus:border-[var(--accent)] outline-none">
                    <button onclick="uploadEncryptedFile()" class="w-full py-3 bg-[var(--accent)] text-black font-black tracking-widest rounded hover:shadow-[0_0_15px_rgba(188,19,254,0.4)] font-mono text-xs">ENCRYPT & UPLOAD</button>
                </div>
                <div class="col-span-2 bg-white/5 border border-white/10 rounded p-6 flex flex-col h-[400px]">
                    <div class="flex justify-between items-center mb-4 border-b border-[var(--border)] pb-2">
                        <label class="text-xs font-mono text-[var(--primary)] tracking-widest">SECURE DATABASE</label>
                        <button onclick="loadFiles()" class="text-[10px] text-gray-500 hover:text-white font-mono">â†» REFRESH</button>
                    </div>
                    <div id="vaultList" class="flex-grow overflow-y-auto pr-2 space-y-2"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CUSTOM CURSOR LOGIC ---
        const cursor = document.getElementById('app-cursor');
        const cursorRing = cursor.querySelector('.cursor-ring');
        
        document.addEventListener('mousemove', (e) => {
            cursor.style.left = e.clientX + 'px';
            cursor.style.top = e.clientY + 'px';
        });

        // Hover Effect
        const interactables = document.querySelectorAll('button, input, textarea, select, a, .border');
        interactables.forEach(el => {
            el.addEventListener('mouseenter', () => document.body.classList.add('hovering'));
            el.addEventListener('mouseleave', () => document.body.classList.remove('hovering'));
        });

        const token = localStorage.getItem('auth-token');
        if (!token) window.location.href = '/login.html';
        function logout() { localStorage.removeItem('auth-token'); window.location.href = '/login.html'; }

        // --- GLOBAL STATE & MEMORY ---
        let mode = 'encrypt';
        // Auto-Key Memory
        const keyCache = { rsa: null, aes: null };

        const DOM = {
            card: document.getElementById('mainCard'),
            algo: document.getElementById('algoSelect'),
            mainIn: document.getElementById('mainInput'),
            keyIn: document.getElementById('keyInput'),
            rsaKeyIn: document.getElementById('rsaKeyInput'),
            out: document.getElementById('outputDisplay'),
            swapBtn: document.getElementById('swapModeBtn'),
            modeTitle: document.getElementById('modeTitle'),
            btnText: document.getElementById('swapBtnText'),
            processBtn: document.getElementById('processBtn'),
            stdGroup: document.getElementById('stdInputGroup'),
            stegoGroup: document.getElementById('stegoInputGroup'),
            keyGroup: document.getElementById('keyGroup'),
            stegoFile: document.getElementById('stegoFile'),
            stegoPayload: document.getElementById('stegoPayload'),
            stegoTextCont: document.getElementById('stegoTextContainer'),
            stegoCanvas: document.getElementById('stegoCanvas'),
            memStatus: document.getElementById('memoryStatus')
        };

        // --- ANIMATION ENGINE ---
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+";
        function animateText(element, finalState) {
            let iterations = 0;
            const interval = setInterval(() => {
                element.innerText = finalState
                    .split("")
                    .map((letter, index) => {
                        if(index < iterations) return finalState[index];
                        return letters[Math.floor(Math.random() * 26)];
                    })
                    .join("");
                if(iterations >= finalState.length) { 
                    clearInterval(interval);
                    element.innerText = finalState;
                }
                iterations += 1;
            }, 5);
        }

        // --- NAVIGATION ---
        function showPage(page) {
            document.getElementById('terminalPage').classList.toggle('hidden', page !== 'terminal');
            document.getElementById('libraryPage').classList.toggle('hidden', page !== 'library');
            const termBtn = document.getElementById('termBtn');
            const libBtn = document.getElementById('libBtn');
            if(page === 'terminal') {
                termBtn.className = "flex items-center gap-2 text-[var(--primary)] font-bold border border-[var(--primary)] bg-black/40 px-5 py-2 rounded-full shadow-[0_0_15px_rgba(0,243,255,0.2)] transition-all";
                libBtn.className = "flex items-center gap-3 text-gray-500 font-bold border border-transparent bg-transparent px-5 py-2 rounded-full hover:text-white transition-all";
            } else {
                libBtn.className = "flex items-center gap-3 text-[var(--primary)] font-bold border border-[var(--border)] bg-black/20 px-5 py-2 rounded-full transition-all";
                termBtn.className = "flex items-center gap-2 text-gray-500 font-bold border border-transparent bg-transparent px-5 py-2 rounded-full hover:text-white transition-all";
            }
        }

        // --- UPDATE MEMORY UI ---
        function updateMemoryStatus() {
            if (keyCache.rsa || keyCache.aes) {
                DOM.memStatus.innerText = "ACTIVE";
                DOM.memStatus.className = "text-green-500 font-bold animate-pulse";
            } else {
                DOM.memStatus.innerText = "OFFLINE";
                DOM.memStatus.className = "text-red-500 font-bold";
            }
        }

        // --- FLIP LOGIC & UI UPDATE ---
        DOM.swapBtn.onclick = () => {
            gsap.to(DOM.card, { rotationY: 90, duration: 0.2, onComplete: () => {
                mode = mode === 'encrypt' ? 'decrypt' : 'encrypt';
                DOM.modeTitle.innerText = mode === 'encrypt' ? "ENCRYPTION MODE" : "DECRYPTION MODE";
                DOM.modeTitle.style.color = mode === 'encrypt' ? "var(--primary)" : "#ff2a2a";
                DOM.btnText.innerText = mode === 'encrypt' ? "ENCRYPT" : "DECRYPT";
                DOM.processBtn.innerText = mode === 'encrypt' ? "EXECUTE ENCRYPTION" : "EXECUTE DECRYPTION";
                DOM.processBtn.style.backgroundColor = mode === 'encrypt' ? "var(--primary)" : "#ff2a2a";
                DOM.out.innerText = "// WAITING FOR INPUT...";
                
                // Stego Logic
                if (DOM.algo.value === 'steganography') {
                    if (mode === 'encrypt') {
                        DOM.stegoTextCont.classList.remove('hidden'); 
                        DOM.processBtn.innerText = "ENCODE & DOWNLOAD";
                    } else {
                        DOM.stegoTextCont.classList.add('hidden');
                        DOM.processBtn.innerText = "DECODE IMAGE";
                    }
                }
                
                // RSA Logic: Update Placeholder for Auto-Decryption
                if (DOM.algo.value === 'rsa') {
                    if (mode === 'decrypt' && keyCache.rsa) {
                        DOM.rsaKeyIn.placeholder = "[ACCESSING CACHED PRIVATE KEY...] (Leave empty to use)";
                    } else {
                        DOM.rsaKeyIn.placeholder = mode === 'encrypt' 
                            ? "Paste Public Key... (Leave empty to Auto-Generate)" 
                            : "Paste Private Key to Decrypt...";
                    }
                }
                // AES Logic: Update Placeholder
                if (DOM.algo.value === 'aes' && mode === 'decrypt' && keyCache.aes) {
                    DOM.keyIn.placeholder = "[ACCESSING CACHED KEY...] (Leave empty to use)";
                }

                gsap.to(DOM.card, { rotationY: 0, duration: 0.3 });
            }});
        };

        // --- UI REFRESH ON ALGO CHANGE ---
        DOM.algo.addEventListener('change', () => {
            const val = DOM.algo.value;
            const isStego = val === 'steganography';
            const isRSA = val === 'rsa';
            const isAsym = ['rsa', 'ecc'].includes(val);
            
            DOM.stdGroup.classList.toggle('hidden', isStego);
            DOM.stegoGroup.classList.toggle('hidden', !isStego);
            
            DOM.keyGroup.classList.toggle('hidden', isStego || (isAsym && !isRSA));
            if (isRSA) {
                DOM.keyIn.classList.add('hidden');
                DOM.rsaKeyIn.classList.remove('hidden');
            } else {
                DOM.keyIn.classList.remove('hidden');
                DOM.rsaKeyIn.classList.add('hidden');
            }

            DOM.out.innerText = "// WAITING...";
            DOM.mainIn.value = "";
            DOM.keyIn.value = "";
            DOM.rsaKeyIn.value = "";
            
            if(val === 'ecc') DOM.processBtn.innerText = "GENERATE CURVE KEYS (SIMULATION)";
            else DOM.processBtn.innerText = mode === 'encrypt' ? "EXECUTE ENCRYPTION" : "EXECUTE DECRYPTION";
            
            if(isStego) {
                DOM.modeTitle.innerText = "STEGANOGRAPHY LAB";
                DOM.modeTitle.style.color = "var(--accent)";
                if(mode==='decrypt') DOM.stegoTextCont.classList.add('hidden');
            } else {
                DOM.modeTitle.innerText = mode === 'encrypt' ? "ENCRYPTION MODE" : "DECRYPTION MODE";
                DOM.modeTitle.style.color = mode === 'encrypt' ? "var(--primary)" : "#ff2a2a";
            }
        });

        // --- MAIN LOGIC ENGINE ---
        DOM.processBtn.onclick = () => {
            const algo = DOM.algo.value;
            
            // 1. IMAGE STEGANOGRAPHY
            if (algo === 'steganography') {
                if (mode === 'encrypt') {
                    if(!DOM.stegoFile.files[0] || !DOM.stegoPayload.value) return alert("Image and Secret Text required!");
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            const ctx = DOM.stegoCanvas.getContext('2d');
                            DOM.stegoCanvas.width = img.width; DOM.stegoCanvas.height = img.height;
                            ctx.drawImage(img, 0, 0);
                            const imgData = ctx.getImageData(0,0,img.width,img.height);
                            const msg = DOM.stegoPayload.value;
                            let bin = ""; 
                            for(let i=0; i<msg.length; i++) bin += msg.charCodeAt(i).toString(2).padStart(8,'0');
                            bin += "00000000";
                            if(bin.length > imgData.data.length/4) return alert("Message too long for this image.");
                            let dIdx = 0;
                            for(let i=0; i<bin.length; i++) {
                                if(dIdx%4===3) dIdx++;
                                imgData.data[dIdx] = (imgData.data[dIdx] & 254) | parseInt(bin[i]);
                                dIdx++;
                            }
                            ctx.putImageData(imgData, 0, 0);
                            const link = document.createElement('a');
                            link.download = 'stego_secret.png';
                            link.href = DOM.stegoCanvas.toDataURL();
                            link.click();
                            animateText(DOM.out, "SUCCESS: Image downloaded.");
                        }; img.src = e.target.result;
                    }; reader.readAsDataURL(DOM.stegoFile.files[0]);
                } else {
                    if(!DOM.stegoFile.files[0]) return alert("Select Encoded Image");
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            const ctx = DOM.stegoCanvas.getContext('2d');
                            DOM.stegoCanvas.width = img.width; DOM.stegoCanvas.height = img.height;
                            ctx.drawImage(img, 0, 0);
                            const data = ctx.getImageData(0,0,img.width,img.height).data;
                            let bin = "", res = "";
                            for(let i=0; i<data.length; i++) {
                                if(i%4===3) continue;
                                bin += (data[i]&1).toString();
                                if(bin.length===8) {
                                    if(bin==="00000000") break;
                                    res += String.fromCharCode(parseInt(bin, 2));
                                    bin = "";
                                }
                            }
                            animateText(DOM.out, "DECODED SECRET:\n" + res);
                        }; img.src = e.target.result;
                    }; reader.readAsDataURL(DOM.stegoFile.files[0]);
                }
                return;
            }

            // 2. TEXT ALGORITHMS
            const txt = DOM.mainIn.value;
            let key = DOM.keyIn.value;
            let res = "";

            if (algo === 'rsa') {
                const encryptor = new JSEncrypt({default_key_size: 512});
                const rsaKeyVal = DOM.rsaKeyIn.value.trim();

                if (mode === 'encrypt') {
                    // ENCRYPT
                    let pubKey = rsaKeyVal;
                    let privKeyMsg = "";
                    
                    if (!pubKey) {
                        // AUTO-GENERATE & CACHE
                        pubKey = encryptor.getPublicKey();
                        const privKey = encryptor.getPrivateKey();
                        keyCache.rsa = privKey; // Save to Memory
                        updateMemoryStatus();
                        privKeyMsg = "\n\n[PRIVATE KEY SAVED TO MEMORY]";
                        encryptor.setPublicKey(pubKey);
                    } else {
                        encryptor.setPublicKey(pubKey);
                    }

                    const encrypted = encryptor.encrypt(txt);
                    if (!encrypted) res = "ENCRYPTION FAILED.";
                    else res = "CIPHERTEXT:\n" + encrypted + privKeyMsg;
                } else {
                    // DECRYPT
                    let decryptKey = rsaKeyVal;
                    
                    // AUTO-DECRYPT CHECK
                    if (!decryptKey && keyCache.rsa) {
                        decryptKey = keyCache.rsa;
                        res = "// SUCCESS: Decrypted using cached Private Key.\n";
                    }
                    
                    if (!decryptKey) return alert("Private Key required for decryption!");
                    encryptor.setPrivateKey(decryptKey);
                    const decrypted = encryptor.decrypt(txt);
                    if (!decrypted) res = "DECRYPTION FAILED.";
                    else res += "DECRYPTED PLAINTEXT:\n" + decrypted;
                }
            }
            else if (algo === 'ecc') {
                res = "ECC CURVE: secp256k1\nPRIVATE: " + Math.random().toString(16).substr(2);
            }
            else if (algo === 'aes') {
                // AES Caching Logic
                if (mode === 'encrypt') {
                    if (!txt || !key) return alert("Text and Key required");
                    keyCache.aes = key; // Cache it
                    updateMemoryStatus();
                    res = CryptoJS.AES.encrypt(txt, key).toString();
                } else {
                    // Auto-Decrypt AES
                    if (!key && keyCache.aes) {
                        key = keyCache.aes;
                        res = "// Using cached AES Key...\n";
                    } else if (!key) {
                        return alert("Key required");
                    }
                    
                    try { 
                        let dec = CryptoJS.AES.decrypt(txt, key).toString(CryptoJS.enc.Utf8);
                        res += dec || "DECRYPTION FAILED"; 
                    } 
                    catch(e) { res = "INVALID KEY/TEXT"; }
                }
            }
            else {
                // Classical Ciphers
                if (!txt) return alert("Enter Text");
                if (algo === 'atbash') {
                    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
                    const rev = "ZYXWVUTSRQPONMLKJIHGFEDCBAzyxwvutsrqponmlkjihgfedcba";
                    res = txt.replace(/[a-zA-Z]/g, c => chars.indexOf(c)>-1 ? rev[chars.indexOf(c)] : c);
                }
                else if (algo === 'caesar') {
                    const s = parseInt(key) || 0;
                    const shift = mode==='encrypt' ? s : -s;
                    res = txt.replace(/[a-zA-Z]/g, c => {
                        const b = c>='a'?97:65;
                        return String.fromCharCode(((c.charCodeAt(0)-b+shift)%26+26)%26+b);
                    });
                }
                else if (algo === 'rail_fence') {
                    res = "Rail Fence Output (Simulated): " + txt.split('').reverse().join('');
                }
                else if (algo === 'pigpen') res = "Pigpen Symbols Generated.";
                else if (algo === 'vigenere') res = "Vigenere Output (Simulated)";
                else if (algo === 'playfair') res = "Playfair Grid Generated";
            }
            
            // Trigger Animation if not stego
            if(algo !== 'steganography') animateText(DOM.out, res);
        };

        // --- VAULT ---
        const vaultModal = document.getElementById('vaultModal');
        function toggleVault(show) {
            if(show) { vaultModal.classList.remove('hidden','pointer-events-none'); setTimeout(()=>vaultModal.classList.remove('opacity-0'),10); loadFiles(); }
            else { vaultModal.classList.add('opacity-0','pointer-events-none'); setTimeout(()=>vaultModal.classList.add('hidden'),300); }
        }
        async function uploadEncryptedFile() {
            const fi = document.getElementById('vaultInput'); const pw = document.getElementById('vaultPass').value;
            if(!fi.files[0] || !pw) return alert("Missing info");
            const reader = new FileReader();
            reader.onload = async (e) => {
                const enc = CryptoJS.AES.encrypt(e.target.result, pw).toString();
                const blob = new Blob([enc],{type:'text/plain'});
                const f = new File([blob], fi.files[0].name+".enc", {type:"text/plain"});
                const fd = new FormData(); fd.append('vaultFile', f);
                await fetch('/api/vault/upload', {method:'POST', headers:{'auth-token':token}, body:fd});
                loadFiles();
            }; reader.readAsDataURL(fi.files[0]);
        }
        async function loadFiles() {
            try { const res = await fetch('/api/vault/myfiles', {headers:{'auth-token':token}}); const files = await res.json();
            const list = document.getElementById('vaultList'); list.innerHTML = '';
            files.forEach(f => { list.innerHTML += `<div class="flex justify-between p-2 bg-black/40 border border-white/5 mb-2 rounded"><span class="text-xs text-gray-400 truncate w-32">${f.originalName}</span><button onclick="downloadAndDecrypt('${f.filename}','${f.originalName}')" class="text-[var(--primary)] text-[10px] border border-[var(--primary)] px-2 rounded">OPEN</button></div>`; });
            } catch(e){}
        }
        async function downloadAndDecrypt(fname, og) {
            const pw = prompt("PASSWORD:"); if(!pw) return;
            const res = await fetch(`/api/vault/file/${fname}?token=${token}`);
            const txt = await res.text();
            try {
                const dec = CryptoJS.AES.decrypt(txt, pw).toString(CryptoJS.enc.Utf8);
                if(!dec.startsWith('data:')) throw new Error();
                const a = document.createElement('a'); a.href=dec; a.download=og.replace('.enc',''); a.click();
            } catch(e) { alert("WRONG PASSWORD"); }
        }
        
        document.getElementById('copyBtn').onclick = () => navigator.clipboard.writeText(DOM.out.innerText);
    </script>
</body>
</html>


this is my entire index.html make the smalll without changing other logics